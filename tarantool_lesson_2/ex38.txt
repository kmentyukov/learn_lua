Предпочтительнее второй вариант. Он информативнее в случае возникновения ошибок. Upsert согласно документации возвращает null, т.е. мы
не можем узнать результат операции. Во втором варианте мы можем контролировать результат на каждом шаге.
С другой стороны upsert работает быстрее, но в данном случае важнее надежность.
